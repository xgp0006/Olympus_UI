#!/bin/bash
# AEROSPACE GATE 1: Pre-commit Validation - ENFORCED, NO EXCEPTIONS
# NASA JPL Rule 10 Compliant: ZERO warnings tolerance
set -e  # Exit on ANY failure - NO EXCEPTIONS

echo "ğŸš€ AEROSPACE GATE 1: Pre-commit Validation"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# Format check - MANDATORY
echo "â–¶ Checking code formatting..."
npm run format -- --check || {
    echo "âŒ GATE FAILED: Format violations detected"
    echo "   Run 'npm run format' to fix formatting issues"
    exit 1
}
echo "âœ… Format check PASSED"

# Lint check - ZERO WARNINGS
echo "â–¶ Running linting checks..."
npm run lint || {
    echo "âŒ GATE FAILED: Linting errors detected"
    echo "   Fix all linting issues before committing"
    exit 1
}
echo "âœ… Lint check PASSED"

# Type checking - MANDATORY
echo "â–¶ Running type checks..."
npm run check || {
    echo "âŒ GATE FAILED: Type errors detected"
    echo "   Fix all TypeScript errors before committing"
    exit 1
}
echo "âœ… Type check PASSED"

# Check for console.log statements in production code
echo "â–¶ Checking for console.log statements..."
if grep -r "console\.log" src --include="*.ts" --include="*.svelte" --include="*.js" | grep -v test | grep -v "test\."; then
    echo "âŒ GATE FAILED: console.log detected in production code"
    echo "   Remove all console.log statements from production code"
    exit 1
fi
echo "âœ… Console.log check PASSED"

# Check for TODO comments
echo "â–¶ Checking for TODO comments..."
if grep -r "TODO\|FIXME\|XXX\|HACK" src --include="*.ts" --include="*.svelte" --include="*.js" | grep -v test; then
    echo "âš ï¸  WARNING: TODO/FIXME/XXX/HACK comments found"
    echo "   Consider addressing these before committing"
fi

echo ""
echo "âœ… AEROSPACE GATE 1 PASSED - Commit allowed"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"